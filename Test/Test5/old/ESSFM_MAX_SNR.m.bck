function [ max_snr,P_max ] = ESSFM_MAX_SNR( Nstep,NC,size_length,n_prop_steps,etasp,gamma,R,Nspan)

options = optimset('Display','off','TolX',3e-1);
funmax = @(dBm) -par_essfm_snr(Nstep,NC,dBm,size_length,n_prop_steps,etasp,gamma,R,Nspan);

[P_max,max_snr] = fminbnd(funmax,-2,10,options);
 max_snr = -max_snr;
end

